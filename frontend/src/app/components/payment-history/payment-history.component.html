<div class="container mt-4">

  <h3 class="text-center mb-4 text-primary fw-bold">Payment History</h3>

  <!-- Totals Cards -->
  <div class="row g-2 mb-3 justify-content-center">
    <div class="col-12 col-md-3">
      <div class="card text-center shadow-sm border-success">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Total All Payments</h6>
          <h5 class="card-title text-success fw-bold">{{ totalAllPayments | currency:'INR' }}</h5>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <div class="card text-center shadow-sm border-primary">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Today's Payments</h6>
          <h5 class="card-title text-primary fw-bold">{{ totalTodayPayments | currency:'INR' }}</h5>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <div class="card text-center shadow-sm border-info">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Filtered Payments</h6>
          <h5 class="card-title text-info fw-bold">{{ totalFiltered | currency:'INR' }}</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="row g-2 mb-3 justify-content-center">
    <div class="col-12 col-sm-6 col-md-3">
     <input type="text"
       class="form-control"
       placeholder="Search by Order ID or Collector..."
       [(ngModel)]="searchTerm"
       (ngModelChange)="applyFilters()">

    </div>
    <div class="col-6 col-sm-3 col-md-2">
      <input type="date" class="form-control" [(ngModel)]="startDate">
    </div>
    <div class="col-6 col-sm-3 col-md-2">
      <input type="date" class="form-control" [(ngModel)]="endDate">
    </div>
    <div class="col-12 col-sm-12 col-md-2 d-flex gap-2">
      <button class="btn btn-primary flex-fill" (click)="applyFilters()">Apply</button>
      <button class="btn btn-success flex-fill" (click)="exportToExcel()">Export Excel</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Payment Table -->
  <div *ngIf="!loading && paginatedPayments.length > 0" class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-primary text-center">
        <tr>
          <th>Order ID</th>
          <th>Amount</th>
          <th>Method</th>
          <th>Collected Name</th>
          <th>Collected At</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let payment of paginatedPayments" class="text-center">
          <td>{{ payment.OrderId }}</td>
          <td>{{ payment.Amount | currency:'INR' }}</td>
          <td>{{ payment.Method }}</td>
          <td>{{ payment.CollectedByName }}</td>
          <td>{{ payment.CollectedAt | date:'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <nav *ngIf="totalPages > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="prevPage()">Previous</button>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="currentPage === i+1">
        <button class="page-link" (click)="goToPage(i+1)">{{ i+1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="nextPage()">Next</button>
      </li>
    </ul>
  </nav>

  <!-- No Payments Message -->
  <div *ngIf="!loading && filteredPayments.length === 0" class="text-center text-danger my-5">
    ⚠️ No payments found
  </div>

</div>
