<div class="container-fluid py-2">

  <!-- Table Grid -->
  <div class="row g-2 mb-3 justify-content-start">
    <div class="col-auto" *ngFor="let table of tables">
      <div class="card text-center shadow-sm rounded cursor-pointer p-2 position-relative"
           [ngClass]="{
             'bg-success text-white': table.Status === 'paid',
             'bg-danger text-white': table.Status === 'occupied',
             'bg-warning text-dark': table.Status === 'pending'
           }"
           (click)="selectTable(table)">
        <h6 class="fw-bold mb-1 small">T {{ table.TableNumber }}</h6>
        <span class="badge rounded-pill px-2 py-1"
              [ngClass]="{
                'bg-light text-dark': table.Status === 'Free',
                'bg-danger text-white': table.Status === 'occupied',
                'bg-warning text-dark': table.Status === 'pending'
              }">{{ table.Status | titlecase }}</span>
      </div>
    </div>
  </div>

  <!-- Main Layout: Left = Menu, Right = Order -->
  <div class="row">

    <!-- Left Side: Menu & Selected Table -->
    <div class="col-lg-8 mb-3">

      <!-- Selected Table Info -->
      <div *ngIf="selectedTable" class="mb-2">
        <div class="alert alert-info rounded-pill text-center fw-bold small">
          üçΩ Selected Table: <span class="text-primary">{{ selectedTable.TableNumber }}</span>
        </div>

        <!-- Menu Search -->
        <div class="mb-2 d-flex justify-content-center">
          <input type="text" class="form-control form-control-sm w-50"
                 placeholder="Search menu..." [(ngModel)]="searchText">
        </div>

        <!-- Category Pills -->
        <div class="d-flex flex-wrap justify-content-start mb-3">
          <button *ngFor="let c of categories"
                  class="btn btn-sm me-2 mb-2"
                  [class.btn-primary]="c.Id === activeCategoryId"
                  [class.btn-outline-primary]="c.Id !== activeCategoryId"
                  (click)="activeCategoryId = c.Id">
            {{ c.Name }}
          </button>
        </div>

        <!-- Menu Items Grid -->
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 g-2">
          <div class="col" *ngFor="let item of getFilteredMenu() | searchFilter:searchText:['Name','Price']">
            <div class="card shadow-sm rounded h-100 text-center p-2 cursor-pointer hover-scale"
                 (click)="addToOrder(item)">
              <div class="card-body p-2">
                <h6 class="fw-bold mb-1 small">{{ item.Name }}</h6>
                <span class="text-success fw-bold small">{{ item.Price | currency:'INR' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Right Side: Order Panel -->
    <div class="col-lg-4 mb-3" *ngIf="selectedTable && orderItems.length > 0">
      <div class="card shadow-lg rounded-3 sticky-top" style="top: 20px;">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
          <span>üßæ Current Order</span>
          <button class="btn btn-sm btn-light" (click)="orderItems = []">Clear</button>
        </div>

        <div class="card-body p-2 table-responsive" style="max-height: 60vh; overflow-y:auto;">
          <table class="table table-sm align-middle mb-0 table-bordered">
            <tbody>
              <tr *ngFor="let item of orderItems">
                <td class="fw-bold small">{{ item.Name }}</td>
                <td class="text-center">
                  <button class="btn btn-sm btn-outline-secondary me-1 py-0 px-1" (click)="decreaseQty(item)">-</button>
                  <span class="fw-bold small">{{ item.qty }}</span>
                  <button class="btn btn-sm btn-outline-secondary ms-1 py-0 px-1" (click)="increaseQty(item)">+</button>
                </td>
                <td class="text-end small">{{ item.Price * item.qty | currency:'INR' }}</td>
                <td class="text-center">
                  <button class="btn btn-sm btn-danger rounded-circle py-0 px-1" (click)="removeItem(item)">‚úï</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="card-footer bg-light text-end">
          <h6 class="fw-bold text-success mb-2">
            Total: {{ getOrderTotal() | currency:'INR' }}
          </h6>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-warning btn-sm flex-fill py-1" (click)="printForKitchen()">
              üç≥ Kitchen Print
            </button>
            <button class="btn btn-primary btn-sm flex-fill py-1" (click)="submitOrder()">
              ‚úÖ Submit Order
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
