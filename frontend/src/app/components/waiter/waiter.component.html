<div class="container-fluid py-3">

  <!-- ğŸª‘ Table Grid -->
  <div class="row g-3 mb-4 justify-content-start">
    <div class="col-6 col-sm-4 col-md-3 col-lg-auto" *ngFor="let table of tables">
      <div class="card text-center shadow-sm rounded-4 p-3 position-relative cursor-pointer table-card"
           [ngClass]="{
             'bg-success text-white': getTableStatus(table) === 'Paid' || getTableStatus(table) === 'Free',
             'bg-danger text-white': getTableStatus(table) === 'occupied',
             'bg-warning text-dark': getTableStatus(table) === 'pending'
           }"
           (click)="selectTable(table)"
           title="Click to select table">
        <h6 class="fw-bold mb-1 small">ğŸª‘ T {{ table.TableNumber }}</h6>
        <h6 class="fw-bold mb-2 small">ğŸ‘¥ Seats {{ table.Seats }}</h6>
        <span class="badge rounded-pill px-2 py-1 w-100"
              [ngClass]="{
                'bg-light text-dark': getTableStatus(table) === 'Free',
                'bg-danger text-white': getTableStatus(table) === 'occupied',
                'bg-warning text-dark': getTableStatus(table) === 'pending'
              }">
          {{ getTableStatus(table) | titlecase }}
        </span>
      </div>
    </div>
  </div>

  <!-- ğŸ½ Main Layout -->
  <div class="row">

    <!-- ğŸ“‹ Left Side: Menu -->
    <div class="col-12 col-lg-8 mb-4">

      <!-- Selected Table Info -->
      <div *ngIf="selectedTable" class="mb-3">
        <div class="alert alert-info rounded-pill text-center fw-bold small sticky-top d-flex justify-content-between align-items-center" style="top: 0; z-index: 10;">
          ğŸ½ Selected Table: <span class="text-primary">{{ selectedTable.TableNumber }}</span>
          <span class="badge bg-secondary ms-2">{{ getTableStatus(selectedTable) }}</span>
        </div>

        <!-- Category Pills -->
        <div class="d-flex flex-wrap gap-2 overflow-auto mb-3">
          <button *ngFor="let c of categories"
                  class="btn btn-sm flex-fill flex-sm-auto category-btn"
                  [class.btn-primary]="c.Id === activeCategoryId"
                  [class.btn-outline-primary]="c.Id !== activeCategoryId"
                  (click)="activeCategoryId = c.Id">
            {{ c.Name }}
          </button>
        </div>

        <!-- Menu Search -->
        <div class="mb-3 d-flex justify-content-center">
          <input type="text" class="form-control form-control-sm w-100 w-sm-75 mx-auto"
                 placeholder="ğŸ” Search menu..." [(ngModel)]="searchText">
        </div>

        <!-- ğŸ” Menu Items Grid -->
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 g-3">
          <div class="col" *ngFor="let item of getFilteredMenu() | searchFilter:searchText:['Name','Price']">
            <div class="card shadow-sm rounded-4 h-100 text-center p-2 menu-card"
                 (click)="addToOrder(item)">
              <div class="card-body p-2 d-flex flex-column justify-content-between">
                <h6 class="fw-bold mb-2 small" style="word-break: break-word;">
                  {{ item.Name }}
                </h6>
                <span class="text-success fw-bold small mt-auto">
                  â‚¹{{ item.Price }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ§¾ Right Side: Order Panel -->
    <div class="col-lg-4 mb-4" *ngIf="selectedTable && orderItems.length > 0">
      <div class="card shadow-lg rounded-4 sticky-top order-panel" style="top: 20px;">

        <!-- Header -->
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
          <span>ğŸ§¾ Current Order ({{ orderItems.length }} items)</span>
          <button class="btn btn-sm btn-light"
           [disabled]="selectedTable?.LastOrder?.Status?.toLowerCase() === 'pending'"
          (click)="clearOrder()">ğŸ—‘ Clear</button>
        </div>

        <!-- Body -->
        <div class="card-body p-2" style="max-height: 60vh; overflow-y:auto;">
          <div *ngFor="let item of orderItems" class="d-flex flex-wrap align-items-center justify-content-between mb-2 p-2 border rounded order-item">
            <div class="fw-bold me-2 flex-grow-1" style="word-break: break-word;">
              {{ item.Name }}
            </div>
            <div class="d-flex align-items-center gap-1 me-2 mt-1 mt-md-0">
              <button class="btn btn-sm btn-outline-secondary py-0 px-2" (click)="decreaseQty(item)">âˆ’</button>
              <span class="px-2 fw-bold">{{ item.qty }}</span>
              <button class="btn btn-sm btn-outline-secondary py-0 px-2" (click)="increaseQty(item)">ï¼‹</button>
            </div>
            <div class="fw-bold text-end me-2 mt-1 mt-md-0" style="min-width: 70px;">
              â‚¹{{ item.Price * item.qty }}
            </div>
            <div class="mt-1 mt-md-0">
              <button class="btn btn-sm btn-danger py-0 px-2" (click)="removeItem(item)">âœ•</button>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="card-footer bg-light text-end d-flex flex-column gap-2">
          <h6 class="fw-bold text-success mb-2 text-end">
            Total: â‚¹{{ getOrderTotal() }}
          </h6>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-warning btn-sm flex-fill py-2 hover-scale" (click)="printForKitchen()">
              ğŸ³ Kitchen Print
            </button>
            <button class="btn btn-primary btn-sm flex-fill py-2 hover-scale" (click)="submitOrder()">
              âœ… Submit Order
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
